!(function(e, t) {
  'object' == typeof exports && 'object' == typeof module
    ? (module.exports = t())
    : 'function' == typeof define && define.amd
    ? define([], t)
    : 'object' == typeof exports
    ? (exports['yab-fetch-cache'] = t())
    : (e['yab-fetch-cache'] = t());
})(window, function() {
  return (function(e) {
    var t = {};
    function n(r) {
      if (t[r]) return t[r].exports;
      var o = (t[r] = { i: r, l: !1, exports: {} });
      return e[r].call(o.exports, o, o.exports, n), (o.l = !0), o.exports;
    }
    return (
      (n.m = e),
      (n.c = t),
      (n.d = function(e, t, r) {
        n.o(e, t) || Object.defineProperty(e, t, { enumerable: !0, get: r });
      }),
      (n.r = function(e) {
        'undefined' != typeof Symbol &&
          Symbol.toStringTag &&
          Object.defineProperty(e, Symbol.toStringTag, { value: 'Module' }),
          Object.defineProperty(e, '__esModule', { value: !0 });
      }),
      (n.t = function(e, t) {
        if ((1 & t && (e = n(e)), 8 & t)) return e;
        if (4 & t && 'object' == typeof e && e && e.__esModule) return e;
        var r = Object.create(null);
        if (
          (n.r(r),
          Object.defineProperty(r, 'default', { enumerable: !0, value: e }),
          2 & t && 'string' != typeof e)
        )
          for (var o in e)
            n.d(
              r,
              o,
              function(t) {
                return e[t];
              }.bind(null, o)
            );
        return r;
      }),
      (n.n = function(e) {
        var t =
          e && e.__esModule
            ? function() {
                return e.default;
              }
            : function() {
                return e;
              };
        return n.d(t, 'a', t), t;
      }),
      (n.o = function(e, t) {
        return Object.prototype.hasOwnProperty.call(e, t);
      }),
      (n.p = ''),
      n((n.s = 0))
    );
  })([
    function(e, t, n) {
      e.exports = n(1);
    },
    function(e, t, n) {
      'use strict';
      function r(e) {
        return new Promise(function(t, n) {
          var r = function() {
              e.removeEventListener('success', o),
                e.removeEventListener('error', u);
            },
            o = function() {
              t(e.result), r();
            },
            u = function() {
              n(e.error), r();
            };
          e.addEventListener('success', o), e.addEventListener('error', u);
        });
      }
      n.r(t);
      var o = function(e, t, n, r) {
          return new (n || (n = Promise))(function(o, u) {
            function i(e) {
              try {
                c(r.next(e));
              } catch (e) {
                u(e);
              }
            }
            function a(e) {
              try {
                c(r.throw(e));
              } catch (e) {
                u(e);
              }
            }
            function c(e) {
              e.done
                ? o(e.value)
                : new n(function(t) {
                    t(e.value);
                  }).then(i, a);
            }
            c((r = r.apply(e, t || [])).next());
          });
        },
        u = function(e, t) {
          var n,
            r,
            o,
            u,
            i = {
              label: 0,
              sent: function() {
                if (1 & o[0]) throw o[1];
                return o[1];
              },
              trys: [],
              ops: []
            };
          return (
            (u = { next: a(0), throw: a(1), return: a(2) }),
            'function' == typeof Symbol &&
              (u[Symbol.iterator] = function() {
                return this;
              }),
            u
          );
          function a(u) {
            return function(a) {
              return (function(u) {
                if (n) throw new TypeError('Generator is already executing.');
                for (; i; )
                  try {
                    if (
                      ((n = 1),
                      r &&
                        (o =
                          2 & u[0]
                            ? r.return
                            : u[0]
                            ? r.throw || ((o = r.return) && o.call(r), 0)
                            : r.next) &&
                        !(o = o.call(r, u[1])).done)
                    )
                      return o;
                    switch (((r = 0), o && (u = [2 & u[0], o.value]), u[0])) {
                      case 0:
                      case 1:
                        o = u;
                        break;
                      case 4:
                        return i.label++, { value: u[1], done: !1 };
                      case 5:
                        i.label++, (r = u[1]), (u = [0]);
                        continue;
                      case 7:
                        (u = i.ops.pop()), i.trys.pop();
                        continue;
                      default:
                        if (
                          !(o = (o = i.trys).length > 0 && o[o.length - 1]) &&
                          (6 === u[0] || 2 === u[0])
                        ) {
                          i = 0;
                          continue;
                        }
                        if (
                          3 === u[0] &&
                          (!o || (u[1] > o[0] && u[1] < o[3]))
                        ) {
                          i.label = u[1];
                          break;
                        }
                        if (6 === u[0] && i.label < o[1]) {
                          (i.label = o[1]), (o = u);
                          break;
                        }
                        if (o && i.label < o[2]) {
                          (i.label = o[2]), i.ops.push(u);
                          break;
                        }
                        o[2] && i.ops.pop(), i.trys.pop();
                        continue;
                    }
                    u = t.call(e, i);
                  } catch (e) {
                    (u = [6, e]), (r = 0);
                  } finally {
                    n = o = 0;
                  }
                if (5 & u[0]) throw u[1];
                return { value: u[0] ? u[1] : void 0, done: !0 };
              })([u, a]);
            };
          }
        },
        i = 'YabDB',
        a = (function() {
          function e(e) {
            void 0 === e && (e = i), (this._databaseName = e);
          }
          return (
            Object.defineProperty(e.prototype, 'request', {
              get: function() {
                return this._request;
              },
              enumerable: !0,
              configurable: !0
            }),
            (e.prototype.init = function() {
              return o(this, void 0, void 0, function() {
                var e;
                return u(this, function(t) {
                  switch (t.label) {
                    case 0:
                      return (
                        (e = indexedDB.open(
                          this._databaseName
                        )).addEventListener('upgradeneeded', function() {
                          var t = e.result;
                          t.objectStoreNames.contains('IDBCache') ||
                            t.createObjectStore('IDBCache', { keyPath: 'url' });
                        }),
                        [4, r(e)]
                      );
                    case 1:
                      return (
                        t.sent(),
                        (this._request = e),
                        (this._store = e.result
                          .transaction(['IDBCache'], 'readwrite')
                          .objectStore('IDBCache')),
                        [2]
                      );
                  }
                });
              });
            }),
            (e.prototype.get = function(e) {
              return o(this, void 0, Promise, function() {
                return u(this, function(t) {
                  switch (t.label) {
                    case 0:
                      return this._store ? [3, 2] : [4, this.init()];
                    case 1:
                      t.sent(), (t.label = 2);
                    case 2:
                      return [2, r(this._store.get(e))];
                  }
                });
              });
            }),
            (e.prototype.set = function(e, t) {
              return o(this, void 0, Promise, function() {
                return u(this, function(n) {
                  switch (n.label) {
                    case 0:
                      return this._store ? [3, 2] : [4, this.init()];
                    case 1:
                      n.sent(), (n.label = 2);
                    case 2:
                      return [2, r(this._store.put({ url: e, data: t }))];
                  }
                });
              });
            }),
            e
          );
        })();
      var c = function() {
          return new a();
        },
        s = function(e, t, n, r) {
          return new (n || (n = Promise))(function(o, u) {
            function i(e) {
              try {
                c(r.next(e));
              } catch (e) {
                u(e);
              }
            }
            function a(e) {
              try {
                c(r.throw(e));
              } catch (e) {
                u(e);
              }
            }
            function c(e) {
              e.done
                ? o(e.value)
                : new n(function(t) {
                    t(e.value);
                  }).then(i, a);
            }
            c((r = r.apply(e, t || [])).next());
          });
        },
        l = function(e, t) {
          var n,
            r,
            o,
            u,
            i = {
              label: 0,
              sent: function() {
                if (1 & o[0]) throw o[1];
                return o[1];
              },
              trys: [],
              ops: []
            };
          return (
            (u = { next: a(0), throw: a(1), return: a(2) }),
            'function' == typeof Symbol &&
              (u[Symbol.iterator] = function() {
                return this;
              }),
            u
          );
          function a(u) {
            return function(a) {
              return (function(u) {
                if (n) throw new TypeError('Generator is already executing.');
                for (; i; )
                  try {
                    if (
                      ((n = 1),
                      r &&
                        (o =
                          2 & u[0]
                            ? r.return
                            : u[0]
                            ? r.throw || ((o = r.return) && o.call(r), 0)
                            : r.next) &&
                        !(o = o.call(r, u[1])).done)
                    )
                      return o;
                    switch (((r = 0), o && (u = [2 & u[0], o.value]), u[0])) {
                      case 0:
                      case 1:
                        o = u;
                        break;
                      case 4:
                        return i.label++, { value: u[1], done: !1 };
                      case 5:
                        i.label++, (r = u[1]), (u = [0]);
                        continue;
                      case 7:
                        (u = i.ops.pop()), i.trys.pop();
                        continue;
                      default:
                        if (
                          !(o = (o = i.trys).length > 0 && o[o.length - 1]) &&
                          (6 === u[0] || 2 === u[0])
                        ) {
                          i = 0;
                          continue;
                        }
                        if (
                          3 === u[0] &&
                          (!o || (u[1] > o[0] && u[1] < o[3]))
                        ) {
                          i.label = u[1];
                          break;
                        }
                        if (6 === u[0] && i.label < o[1]) {
                          (i.label = o[1]), (o = u);
                          break;
                        }
                        if (o && i.label < o[2]) {
                          (i.label = o[2]), i.ops.push(u);
                          break;
                        }
                        o[2] && i.ops.pop(), i.trys.pop();
                        continue;
                    }
                    u = t.call(e, i);
                  } catch (e) {
                    (u = [6, e]), (r = 0);
                  } finally {
                    n = o = 0;
                  }
                if (5 & u[0]) throw u[1];
                return { value: u[0] ? u[1] : void 0, done: !0 };
              })([u, a]);
            };
          }
        };
      function f(e, t, n) {
        return s(this, void 0, Promise, function() {
          var r;
          return l(this, function(o) {
            switch (o.label) {
              case 0:
                return [4, t.get(n)];
              case 1:
                return (r = o.sent()) && (e.json = r.data), [2, !!r];
            }
          });
        });
      }
      var p = function(e) {
        var t = this;
        void 0 === e && (e = {});
        var n = e.cache,
          r = void 0 === n ? c() : n,
          o = e.strategy,
          u = void 0 === o ? 'fallback' : o;
        return function(e, n) {
          return s(t, void 0, void 0, function() {
            var t, o;
            return l(this, function(i) {
              switch (i.label) {
                case 0:
                  return (
                    (t = e.yabRequestInit.url),
                    'always' !== u ? [3, 2] : [4, f(e, r, t)]
                  );
                case 1:
                  if (i.sent()) return [2];
                  i.label = 2;
                case 2:
                  return i.trys.push([2, 4, , 7]), [4, n()];
                case 3:
                  return i.sent(), [3, 7];
                case 4:
                  return (
                    (o = i.sent()), 'fallback' !== u ? [3, 6] : [4, f(e, r, t)]
                  );
                case 5:
                  if (i.sent()) return [2];
                  i.label = 6;
                case 6:
                  throw o;
                case 7:
                  return r.set(t, e.json), [2];
              }
            });
          });
        };
      };
      n.d(t, 'createCacheMiddleware', function() {
        return p;
      });
    }
  ]);
});
